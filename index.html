<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Blackjack con Conteo Hi-Lo Mejorado</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #0b3d0b;
        color: white;
        display: flex;
        flex-direction: row;
        margin: 0;
    }
    #game-area {
        flex: 3;
        padding: 20px;
    }
    #side-panel {
        flex: 1;
        background: #111;
        padding: 15px;
        overflow-y: auto;
    }
    .hand {
        display: flex;
        flex-direction: row;
        margin: 10px 0;
    }
    .card {
        width: 80px;
        height: 120px;
        margin-right: -50px;
        transition: transform 0.4s ease;
    }
    .card.dealt {
        transform: translateX(0) translateY(0);
    }
    #controls button {
        margin: 5px;
        padding: 10px;
        font-size: 16px;
        cursor: pointer;
    }
    .stats {
        margin-top: 10px;
        background: #222;
        padding: 10px;
        border-radius: 8px;
    }
    .history-entry {
        border-bottom: 1px solid #444;
        padding: 5px 0;
    }
</style>
</head>
<body>

<div id="game-area">
    <h1>Blackjack - Conteo Hi-Lo</h1>
    <div class="stats">
        <div>Saldo: $<span id="balance">1000</span></div>
        <div>Apuesta: $<span id="current-bet">0</span></div>
        <div>Ganancias/Pérdidas: <span id="profit-loss">0</span></div>
    </div>

    <div>
        <h3>Mano del Crupier</h3>
        <div id="dealer-hand" class="hand"></div>
    </div>

    <div>
        <h3>Tu Mano</h3>
        <div id="player-hand" class="hand"></div>
    </div>

    <div id="controls">
        <button onclick="placeBet(50)">Apostar 50</button>
        <button onclick="placeBet(100)">Apostar 100</button>
        <button onclick="doubleBet()">Doblar</button>
        <button onclick="hit()">Pedir</button>
        <button onclick="stand()">Plantarse</button>
        <button onclick="surrender()">Rendirse</button>
        <button onclick="newRound()">Nueva Ronda</button>
    </div>

    <audio id="card-sound" src="card.mp3"></audio>
</div>

<div id="side-panel">
    <h3>Historial</h3>
    <div id="history"></div>
    <h4>Conteo</h4>
    <div>Running Count: <span id="running-count">0</span></div>
    <div>True Count: <span id="true-count">0</span></div>
</div>

<script>
const deckImagesPath = "img/cartas/"; // Carpeta de tus cartas actuales
const suits = ["C", "D", "H", "S"]; // trébol, diamante, corazón, pica
const values = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
let deck = [];
let playerHand = [];
let dealerHand = [];
let balance = 1000;
let currentBet = 0;
let profitLoss = 0;
let runningCount = 0;
let cardsDealt = 0;
let totalCards = 104; // 2 mazos

function createDeck() {
    deck = [];
    for (let d = 0; d < 2; d++) { // 2 mazos
        for (let s of suits) {
            for (let v of values) {
                deck.push({value: v, suit: s});
            }
        }
    }
    shuffle(deck);
}

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function cardValue(card) {
    if (["J","Q","K"].includes(card.value)) return 10;
    if (card.value === "A") return 11;
    return parseInt(card.value);
}

function hiLoValue(card) {
    if (["2","3","4","5","6"].includes(card.value)) return 1;
    if (["10","J","Q","K","A"].includes(card.value)) return -1;
    return 0;
}

function dealCard(toHand, handDiv) {
    let card = deck.pop();
    cardsDealt++;
    runningCount += hiLoValue(card);
    let cardImg = document.createElement("img");
    cardImg.src = `${deckImagesPath}${card.value}${card.suit}.png`;
    cardImg.className = "card";
    cardImg.style.transform = "translateX(-500px)";
    handDiv.appendChild(cardImg);
    setTimeout(() => {
        cardImg.classList.add("dealt");
        cardImg.style.transform = "translateX(0)";
        document.getElementById("card-sound").play();
    }, 100);
    toHand.push(card);
    updateCounts();
}

function updateCounts() {
    let decksRemaining = ((totalCards - cardsDealt) / 52).toFixed(2);
    document.getElementById("running-count").textContent = runningCount;
    document.getElementById("true-count").textContent = (runningCount / decksRemaining).toFixed(2);
}

function placeBet(amount) {
    if (balance >= amount) {
        currentBet += amount;
        balance -= amount;
        updateStats();
    }
}

function doubleBet() {
    if (balance >= currentBet) {
        balance -= currentBet;
        currentBet *= 2;
        updateStats();
    }
}

function surrender() {
    balance += currentBet / 2;
    profitLoss -= currentBet / 2;
    currentBet = 0;
    updateStats();
}

function updateStats() {
    document.getElementById("balance").textContent = balance;
    document.getElementById("current-bet").textContent = currentBet;
    document.getElementById("profit-loss").textContent = profitLoss;
}

function newRound() {
    if (deck.length < 15) createDeck();
    playerHand = [];
    dealerHand = [];
    document.getElementById("player-hand").innerHTML = "";
    document.getElementById("dealer-hand").innerHTML = "";
    dealCard(playerHand, document.getElementById("player-hand"));
    dealCard(dealerHand, document.getElementById("dealer-hand"));
    dealCard(playerHand, document.getElementById("player-hand"));
    dealCard(dealerHand, document.getElementById("dealer-hand"));
}

function hit() {
    dealCard(playerHand, document.getElementById("player-hand"));
}

function stand() {
    // lógica simple crupier
    while (handValue(dealerHand) < 17) {
        dealCard(dealerHand, document.getElementById("dealer-hand"));
    }
    checkWinner();
}

function handValue(hand) {
    let value = 0, aces = 0;
    for (let c of hand) {
        value += cardValue(c);
        if (c.value === "A") aces++;
    }
    while (value > 21 && aces > 0) {
        value -= 10;
        aces--;
    }
    return value;
}

function checkWinner() {
    let playerVal = handValue(playerHand);
    let dealerVal = handValue(dealerHand);
    let result = "";
    if (playerVal > 21) {
        result = "Perdiste";
        profitLoss -= currentBet;
    } else if (dealerVal > 21 || playerVal > dealerVal) {
        result = "Ganaste";
        balance += currentBet * 2;
        profitLoss += currentBet;
    } else if (playerVal < dealerVal) {
        result = "Perdiste";
        profitLoss -= currentBet;
    } else {
        result = "Empate";
        balance += currentBet;
    }
    addHistory(result, playerHand, dealerHand, runningCount);
    currentBet = 0;
    updateStats();
}

function addHistory(result, pHand, dHand, count) {
    let hist = document.getElementById("history");
    let entry = document.createElement("div");
    entry.className = "history-entry";
    entry.innerHTML = `<b>${result}</b> - Jugador: ${pHand.map(c=>c.value+c.suit).join(", ")} / Crupier: ${dHand.map(c=>c.value+c.suit).join(", ")} - RC: ${count}`;
    hist.prepend(entry);
}

createDeck();
updateStats();
</script>
</body>
</html>