<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Blackjack Hi-Lo — 2 mazos + animación</title>
<style>
  :root{
    --table:#0b6b3a;
    --panel:#1f2b2a;
    --muted:#cbd5cf;
    --accent:#f2b844;
    --card-w:90px;
    --card-h:126px;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:#072a1a;color:#f3f6f4}
  .app {display:flex;height:100vh;gap:12px;padding:12px;box-sizing:border-box}
  /* Mesa */
  .table {
    flex:1;
    background: linear-gradient(180deg,var(--table), #083b28 80%);
    border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
    padding:18px;
    position:relative;
    overflow:hidden;
  }
  header {display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  h1{margin:0;font-size:20px;color:var(--accent);text-shadow:0 0 8px rgba(242,184,68,0.25)}
  .controls {display:flex;gap:8px;align-items:center}
  input[type=number]{width:110px;padding:8px;border-radius:8px;border:none;font-weight:600;text-align:center}
  button{padding:8px 12px;border-radius:8px;border:none;background:#1fb06f;color:white;cursor:pointer;font-weight:700}
  button.secondary{background:#2d8db3}
  button.warn{background:#d35400}
  button:disabled{opacity:.45;cursor:default}
  /* Areas para manos */
  .area {display:flex;flex-direction:column;align-items:center;gap:8px;margin:8px 0}
  .cards-row {display:flex;gap:10px;min-height:var(--card-h);align-items:end;justify-content:center}
  .card-slot {width:var(--card-w);height:var(--card-h);position:relative}
  .card-img {width:var(--card-w);height:var(--card-h);border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.6);position:absolute;left:0;top:0;transform-origin:center;backface-visibility:hidden}
  /* deck pile */
  .deck-pile {position:absolute;right:28px;top:60px;width:var(--card-w);height:var(--card-h);pointer-events:none}
  .deck-back{width:100%;height:100%;opacity:.95;border-radius:8px}
  /* floating animated card (positioned absolutely during deal) */
  .anim-card {position:absolute;width:var(--card-w);height:var(--card-h);z-index:999;pointer-events:none;border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,0.7)}
  /* side panel */
  .panel {
    width:360px;
    background:var(--panel);
    border-radius:12px;
    padding:12px;
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
    overflow:auto;
  }
  .panel h2{margin:4px 0 12px;color:var(--accent)}
  .stat {display:flex;justify-content:space-between;padding:6px 8px;border-radius:8px;margin-bottom:6px;background:rgba(255,255,255,0.02);font-weight:700}
  .small {font-size:13px;color:var(--muted)}
  .history-entry{border-top:1px dashed rgba(255,255,255,0.04);padding:8px 0}
  .history-cards {display:flex;gap:6px;margin-top:6px;flex-wrap:wrap}
  .thumb {width:48px;height:68px;border-radius:6px;box-shadow:0 6px 12px rgba(0,0,0,.5)}
  /* real-time count bubble */
  .count-bubble {
    position:absolute;left:22px;top:22px;background:rgba(0,0,0,0.5);padding:8px 12px;border-radius:999px;font-weight:800;color:var(--accent);backdrop-filter:blur(4px)
  }
  /* flip animation */
  .flip { transform-style:preserve-3d; transition:transform .42s ease; }
  .flip.flip-show { transform: rotateY(180deg); }
  .card-face { position:absolute; inset:0; backface-visibility:hidden; border-radius:8px; }
  .card-back { transform: rotateY(180deg); }
  /* accessibility & misc */
  .bottom-controls {position:absolute;left:18px;right:18px;bottom:18px;display:flex;justify-content:space-between;align-items:center;gap:8px}
  .notice {font-size:13px;color:#ffdca1}
  .muted {color:var(--muted)}
  @media (max-width:980px){
    .app{flex-direction:column}
    .panel{width:100%;height:320px;order:2}
  }
</style>
</head>
<body>
<div class="app">
  <div class="table" id="table">
    <header>
      <h1>Blackjack Hi-Lo — 2 mazos</h1>
      <div class="controls">
        <label class="small muted">Saldo inicial $</label>
        <input id="initialBalance" type="number" value="1000" min="1" />
        <button id="setBalance" class="secondary">Establecer</button>
      </div>
    </header>

    <div class="count-bubble" id="runningCount">Conteo: 0</div>

    <!-- Dealer -->
    <div class="area">
      <div class="small muted">Casa</div>
      <div class="cards-row" id="dealerRow"></div>
      <div class="small muted">Suma: <span id="dealerSum">?</span></div>
    </div>

    <!-- Center: deck pile -->
    <div style="display:flex;justify-content:center;margin:8px 0;align-items:center;gap:20px">
      <div style="text-align:center">
        <div class="deck-pile" id="deckPile" title="Mazo (2 barajas)"><img id="deckBack" class="deck-back" src="https://deckofcardsapi.com/static/img/back.png" alt="back"></div>
        <div class="small muted">Cartas restantes: <span id="cardsLeft">104</span></div>
      </div>
      <div style="width:420px;text-align:center">
        <div class="notice" id="sessionNotice">Sesión lista — presiona "Empezar ronda"</div>
      </div>
    </div>

    <!-- Player -->
    <div class="area">
      <div class="small muted">Jugador</div>
      <div class="cards-row" id="playerRow"></div>
      <div class="small muted">Suma: <span id="playerSum">0</span></div>
    </div>

    <!-- Controls bottom -->
    <div class="bottom-controls">
      <div style="display:flex;gap:8px;align-items:center">
        <label class="small muted">Apuesta $</label>
        <input id="betInput" type="number" value="50" min="1" style="width:120px;padding:6px;border-radius:8px;border:none;text-align:center"/>
        <button id="btnStart">Empezar ronda</button>
        <button id="btnHit" disabled>Pedir</button>
        <button id="btnStand" disabled>Plantarse</button>
        <button id="btnDouble" disabled>Doblar</button>
        <button id="btnSurrender" disabled class="warn">Rendirse</button>
      </div>

      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
        <div class="stat"><span>Saldo</span><span id="balanceDisplay">$1000</span></div>
        <div class="stat"><span>Total ganado</span><span id="wonDisplay">$0</span></div>
      </div>
    </div>

    <!-- animated card holder -->
    <div id="animLayer"></div>
  </div>

  <!-- Side panel -->
  <aside class="panel" id="panel">
    <h2>Historial — Rondas</h2>
    <div id="historyList"></div>

    <h2 style="margin-top:12px">Contador por ronda</h2>
    <div id="perRoundCounts" class="small muted"></div>

    <h2 style="margin-top:12px">Configuración</h2>
    <div class="small muted">
      <label><input type="checkbox" id="cbSound" checked/> Sonidos</label><br>
      <label><input type="checkbox" id="cbDaltonic"/> Modo daltónico</label><br>
      <label><input type="checkbox" id="cbHighContrast"/> Alto contraste</label><br>
      <div style="margin-top:8px">
        <button id="btnReset" class="secondary">Reiniciar sesión (mezclar 2 mazos)</button>
      </div>
    </div>
  </aside>
</div>

<!-- sounds -->
<audio id="sndCard" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
<audio id="sndButton" src="https://actions.google.com/sounds/v1/buttons/button_click.ogg" preload="auto"></audio>
<audio id="sndWin" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>

<script>
/* ------------- Config & assets ------------- */
const CARD_BACK = 'https://deckofcardsapi.com/static/img/back.png';
const RANK_MAP = { '10':'0' }; // deckofcards api uses "0" for 10 in file names
const IMG_BASE = 'https://deckofcardsapi.com/static/img/'; // + code + .png

const table = document.getElementById('table');
const deckPile = document.getElementById('deckPile');
const deckBackImg = document.getElementById('deckBack');
const animLayer = document.getElementById('animLayer');
const playerRow = document.getElementById('playerRow');
const dealerRow = document.getElementById('dealerRow');
const playerSumEl = document.getElementById('playerSum');
const dealerSumEl = document.getElementById('dealerSum');
const runningCountEl = document.getElementById('runningCount');
const cardsLeftEl = document.getElementById('cardsLeft');
const historyList = document.getElementById('historyList');
const perRoundCounts = document.getElementById('perRoundCounts');
const balanceDisplay = document.getElementById('balanceDisplay');
const wonDisplay = document.getElementById('wonDisplay');
const sessionNotice = document.getElementById('sessionNotice');

const sndCard = document.getElementById('sndCard');
const sndButton = document.getElementById('sndButton');
const sndWin = document.getElementById('sndWin');

const btnStart = document.getElementById('btnStart');
const btnHit = document.getElementById('btnHit');
const btnStand = document.getElementById('btnStand');
const btnDouble = document.getElementById('btnDouble');
const btnSurrender = document.getElementById('btnSurrender');
const btnReset = document.getElementById('btnReset');
const setBalance = document.getElementById('setBalance');

const cbSound = document.getElementById('cbSound');
const cbDaltonic = document.getElementById('cbDaltonic');
const cbHighContrast = document.getElementById('cbHighContrast');
const initialBalance = document.getElementById('initialBalance');
const betInput = document.getElementById('betInput');
const btnSnd = sndButton;

/* ------------- Game state ------------- */
let deck = []; // array of card objects {code:'AS', rank:'A', suit:'S'}
let twoDecks = true;
let runningCount = 0;
let roundIndex = 0;
let rounds = []; // store per-round info
let playerHand = [];
let dealerHand = [];
let playerSum = 0;
let dealerSum = 0;
let inRound = false;
let balance = parseInt(initialBalance.value,10) || 1000;
let totalWon = 0;

/* ------------- Helpers: build 2 decks and shuffle ------------- */
const RANKS = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const SUITS = ['S','H','D','C']; // S=spades,H=hearts,D=diamonds,C=clubs

function buildDecks(decks=2){
  deck = [];
  for(let d=0; d<decks; d++){
    for(let r of RANKS){
      for(let s of SUITS){
        const codeRank = (r === '10') ? RANK_MAP['10'] : r;
        const code = codeRank + s;
        deck.push({ rank: r, suit: s, code });
      }
    }
  }
  shuffle(deck);
}
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}

/* ------------- Hi-Lo value ------------- */
function hiLoValue(rank){
  if (['2','3','4','5','6'].includes(rank)) return 1;
  if (['7','8','9'].includes(rank)) return 0;
  return -1;
}

/* ------------- DOM utility: play sound ------------- */
function playSound(audio){
  if (!cbSound.checked) return;
  try { audio.currentTime = 0; audio.play(); } catch(e){}
}

/* ------------- Draw + animate card dealing ------------- */
function drawRaw(){
  if(deck.length===0){
    // reshuffle automatically with two decks
    buildDecks(2);
    sessionNotice.textContent = 'Se rebarajó (2 mazos)';
    runningCount = 0; // reset running count when reshuffle whole shoe
    rounds = [];
    updateSidePanel();
  }
  const c = deck.pop();
  cardsLeftEl.textContent = deck.length;
  return c;
}

// animate dealing from deck pile to targetElement; returns Promise
function dealAnimated(cardObj, targetEl, reveal=true){
  return new Promise(resolve=>{
    const deckRect = deckBackImg.getBoundingClientRect();
    const targetRect = targetEl.getBoundingClientRect();
    const img = document.createElement('img');
    img.className = 'anim-card flip';
    img.src = CARD_BACK;
    img.style.left = deckRect.left + 'px';
    img.style.top = deckRect.top + 'px';
    img.style.width = getComputedStyle(deckBackImg).width;
    img.style.height = getComputedStyle(deckBackImg).height;
    animLayer.appendChild(img);

    // move to center of target
    const toX = targetRect.left + (targetRect.width - img.clientWidth)/2;
    const toY = targetRect.top + (targetRect.height - img.clientHeight)/2;

    // trigger reflow then animate
    requestAnimationFrame(()=>{
      img.style.transition = 'transform .6s cubic-bezier(.2,.8,.2,1), left .6s, top .6s';
      img.style.left = toX + 'px';
      img.style.top = toY + 'px';
      img.style.transform = 'translateZ(0) scale(1)';
      playSound(sndCard);
    });

    // after move complete, flip (simulate)
    setTimeout(()=>{
      // flip: rotateY to 180
      img.classList.add('flip-show'); // CSS rotates to 180
      // actually swap to face after half time
      setTimeout(()=>{
        const codeUrl = IMG_BASE + cardObj.code + '.png';
        img.src = codeUrl;
        // after flip finish, append small static thumbnail inside slot
        setTimeout(()=>{
          animLayer.removeChild(img);
          const thumb = document.createElement('img');
          thumb.className = 'card-img';
          thumb.src = codeUrl;
          // place inside slot (targetEl is .cards-row)
          const slot = document.createElement('div');
          slot.className = 'card-slot';
          slot.appendChild(thumb);
          targetEl.appendChild(slot);
          resolve();
        }, 160);
      }, 220);
    }, 700);
  });
}

/* ------------- Fast deal without animation (initial if needed) ------------- */
function appendCardThumbnail(cardObj, targetEl){
  const codeUrl = IMG_BASE + cardObj.code + '.png';
  const thumb = document.createElement('img');
  thumb.className = 'card-img';
  thumb.src = codeUrl;
  const slot = document.createElement('div');
  slot.className = 'card-slot';
  slot.appendChild(thumb);
  targetEl.appendChild(slot);
}

/* ------------- Clear rows ------------- */
function clearRows(){
  playerRow.innerHTML = '';
  dealerRow.innerHTML = '';
}

/* ------------- Calculate hand value ------------- */
function valueOf(hand){
  let total=0, aces=0;
  for(let c of hand){
    if (['J','Q','K'].includes(c.rank)) total += 10;
    else if (c.rank === 'A'){ total += 11; aces++; }
    else total += parseInt(c.rank);
  }
  while(total > 21 && aces > 0){ total -= 10; aces--; }
  return total;
}

/* ------------- Round lifecycle ------------- */
async function startRound(){
  if (inRound) return;
  playSound(sndButton);
  const bet = parseInt(betInput.value,10) || 1;
  if (bet <=0) { alert('Apuesta válida > 0'); return; }
  if (bet > balance){ alert('Saldo insuficiente'); return; }
  // initialize
  inRound = true;
  roundIndex++;
  playerHand = []; dealerHand = [];
  clearRows();
  // remove previous floating anims
  animLayer.innerHTML = '';
  // take bet
  balance -= bet;
  balanceDisplay.textContent = '$' + balance;
  sessionNotice.textContent = `Ronda ${roundIndex} — repartiendo...`;
  // Deal: player, dealer, player, dealer (animated sequential)
  // Ensure deck has enough cards
  if (deck.length < 20){ buildDecks(2); shuffle(deck); sessionNotice.textContent = 'Se rebarajó el zapato (2 mazos)'; runningCount=0; rounds=[]; updateSidePanel(); }

  // sequential deal with animation
  const c1 = drawRaw(); // to player
  playerHand.push(c1);
  runningCount += hiLoValue(c1.rank);
  await dealAnimated(c1, playerRow);
  updateRunningCount();

  const c2 = drawRaw(); // to dealer
  dealerHand.push(c2);
  runningCount += hiLoValue(c2.rank);
  await dealAnimated(c2, dealerRow);
  updateRunningCount();

  const c3 = drawRaw(); // to player
  playerHand.push(c3);
  runningCount += hiLoValue(c3.rank);
  await dealAnimated(c3, playerRow);
  updateRunningCount();

  const c4 = drawRaw(); // to dealer
  dealerHand.push(c4);
  runningCount += hiLoValue(c4.rank);
  await dealAnimated(c4, dealerRow);
  updateRunningCount();

  // update sums
  playerSum = valueOf(playerHand);
  dealerSum = valueOf(dealerHand);
  playerSumEl.textContent = playerSum;
  dealerSumEl.textContent = '?'; // hide dealer full sum until stand
  // enable actions
  btnHit.disabled = false; btnStand.disabled = false; btnDouble.disabled = false; btnSurrender.disabled = false;
  // save round placeholder
  rounds.push({
    round: roundIndex,
    bet,
    player: [...playerHand],
    dealer: [...dealerHand],
    runningAfter: runningCount,
    events: []
  });
  updateSidePanel();
}

async function playerHit(){
  if (!inRound) return;
  btnHit.disabled = true; // disable temporarily while animating
  const card = drawRaw();
  playerHand.push(card);
  runningCount += hiLoValue(card.rank);
  await dealAnimated(card, playerRow);
  updateRunningCount();
  playerSum = valueOf(playerHand);
  playerSumEl.textContent = playerSum;
  rounds[rounds.length-1].events.push({type:'hit', card:card.code, runningAfter:runningCount});
  if (playerSum > 21){
    // bust
    await finishRound(false);
    return;
  }
  btnHit.disabled = false;
}

async function playerStand(){
  if (!inRound) return;
  btnHit.disabled = true; btnStand.disabled = true; btnDouble.disabled = true; btnSurrender.disabled = true;
  // Dealer plays until 17
  dealerSum = valueOf(dealerHand);
  dealerSumEl.textContent = dealerSum;
  while (dealerSum < 17){
    const card = drawRaw();
    dealerHand.push(card);
    runningCount += hiLoValue(card.rank);
    await dealAnimated(card, dealerRow);
    updateRunningCount();
    dealerSum = valueOf(dealerHand);
    dealerSumEl.textContent = dealerSum;
    rounds[rounds.length-1].events.push({type:'dealer-hit', card:card.code, runningAfter:runningCount});
  }
  // determine
  const playerVal = valueOf(playerHand);
  const dealerVal = valueOf(dealerHand);
  let playerWins = false;
  if (dealerVal > 21) playerWins = true;
  else if (playerVal > dealerVal) playerWins = true;
  else playerWins = false;
  await finishRound(playerWins);
}

async function doubleDown(){
  if (!inRound) return;
  const lastRound = rounds[rounds.length-1];
  const bet = lastRound.bet;
  if (balance < bet){ alert('Saldo insuficiente para doblar'); return; }
  // double the bet
  balance -= bet;
  lastRound.bet = bet * 2;
  balanceDisplay.textContent = '$' + balance;
  // draw one card and stand automatically
  btnDouble.disabled = true; btnSurrender.disabled = true;
  const card = drawRaw();
  playerHand.push(card);
  runningCount += hiLoValue(card.rank);
  await dealAnimated(card, playerRow);
  updateRunningCount();
  rounds[rounds.length-1].events.push({type:'double-hit', card:card.code, runningAfter:runningCount});
  playerSum = valueOf(playerHand);
  playerSumEl.textContent = playerSum;
  if (playerSum > 21){ await finishRound(false); return; }
  await playerStand();
}

async function surrender(){
  if (!inRound) return;
  // player receives half bet back, round ends as loss (half)
  const lastRound = rounds[rounds.length-1];
  const bet = lastRound.bet;
  const half = Math.ceil(bet/2);
  balance += half;
  balanceDisplay.textContent = '$' + balance;
  rounds[rounds.length-1].result = 'Rendición';
  rounds[rounds.length-1].balanceAfter = balance;
  rounds[rounds.length-1].runningAfter = runningCount;
  inRound = false;
  btnHit.disabled = true; btnStand.disabled = true; btnDouble.disabled = true; btnSurrender.disabled = true;
  sessionNotice.textContent = `Ronda ${roundIndex}: Rendición (-50%)`;
  updateSidePanel();
  playSound(sndButton);
}

/* ------------- Finish round - payout & history ------------- */
async function finishRound(playerWon){
  const last = rounds[rounds.length-1];
  const bet = last.bet;
  if (playerWon){
    // payout: player gets 2x the bet (we already subtracted bet at start)
    const payout = bet * 2;
    balance += payout;
    totalWon += payout - bet; // net
    last.result = 'Ganó';
    playSound(sndWin);
  } else {
    last.result = last.result === 'Rendición' ? 'Rendición' : 'Perdió';
  }
  last.balanceAfter = balance;
  last.player = [...playerHand];
  last.dealer = [...dealerHand];
  last.runningAfter = runningCount;
  inRound = false;
  btnHit.disabled = true; btnStand.disabled = true; btnDouble.disabled = true; btnSurrender.disabled = true;
  sessionNotice.textContent = `Ronda ${roundIndex} finalizada — ${last.result}`;
  balanceDisplay.textContent = '$' + balance;
  wonDisplay.textContent = '$' + totalWon;
  updateSidePanel();
}

/* ------------- UI helpers ------------- */
function updateRunningCount(){
  runningCountEl.textContent = 'Conteo: ' + runningCount;
}
function updateSidePanel(){
  // history list
  historyList.innerHTML = '';
  for(let r of rounds.slice().reverse()){
    const div = document.createElement('div');
    div.className = 'history-entry';
    div.innerHTML = `<div style="display:flex;justify-content:space-between"><strong>Ronda ${r.round}</strong><span class="small muted">Apuesta $${r.bet}</span></div>
      <div class="small-muted small">${r.result || 'En espera'}</div>
      <div class="history-cards"></div>
      <div class="small muted" style="margin-top:6px">Conteo final: ${r.runningAfter ?? runningCount}</div>
      <div class="small muted">Saldo: $${r.balanceAfter ?? balance}</div>`;
    const cardsDiv = div.querySelector('.history-cards');
    const cardsToShow = (r.player || []).concat(r.dealer || []);
    for(let c of cardsToShow.slice(0,10)){
      const img = document.createElement('img');
      img.className = 'thumb';
      const code = c.code ? c.code : c;
      img.src = IMG_BASE + code + '.png';
      cardsDiv.appendChild(img);
    }
    historyList.appendChild(div);
  }

  // per-round counts
  perRoundCounts.innerHTML = '';
  for(let r of rounds){
    const p = document.createElement('div');
    p.className = 'small muted';
    p.textContent = `R${r.round}: Conteo después ${r.runningAfter ?? runningCount} — Apuesta $${r.bet} — ${r.result ?? '—'}`;
    perRoundCounts.appendChild(p);
  }
}

/* ------------- Buttons wiring ------------- */
btnStart.addEventListener('click', ()=>{ playSound(sndButton); startRound(); });
btnHit.addEventListener('click', ()=>{ playSound(sndButton); playerHit(); });
btnStand.addEventListener('click', ()=>{ playSound(sndButton); playerStand(); });
btnDouble.addEventListener('click', ()=>{ playSound(sndButton); doubleDown(); });
btnSurrender.addEventListener('click', ()=>{ playSound(sndButton); surrender(); });
btnReset.addEventListener('click', ()=>{ playSound(sndButton); buildDecks(2); shuffle(deck); runningCount=0; rounds=[]; roundIndex=0; balance = parseInt(initialBalance.value,10) || 1000; balanceDisplay.textContent='$'+balance; cardsLeftEl.textContent=deck.length; sessionNotice.textContent='Zapato mezclado (2 mazos)'; updateSidePanel(); });

setBalance.addEventListener('click', ()=>{
  balance = parseInt(initialBalance.value,10) || balance;
  balanceDisplay.textContent = '$' + balance;
  playSound(sndButton);
});

/* accessibility toggles */
cbDaltonic.addEventListener('change', ()=>{ document.body.classList.toggle('daltonic', cbDaltonic.checked); });
cbHighContrast.addEventListener('change', ()=>{ document.body.classList.toggle('contrast-high', cbHighContrast.checked); });
cbSound.addEventListener('change', ()=>{ /* noop */ });

/* ensure enabling/disabling of action buttons after each deal */
function enableActionButtons(){
  btnHit.disabled = false; btnStand.disabled = false; btnDouble.disabled = false; btnSurrender.disabled = false;
}

/* wrap playerHit to update buttons properly */
async function playerHit(){
  if (!inRound) return;
  btnHit.disabled = true;
  const card = drawRaw();
  playerHand.push(card);
  runningCount += hiLoValue(card.rank);
  await dealAnimated(card, playerRow);
  updateRunningCount();
  playerSum = valueOf(playerHand);
  playerSumEl.textContent = playerSum;
  rounds[rounds.length-1].events = rounds[rounds.length-1].events || [];
  rounds[rounds.length-1].events.push({type:'hit',card:card.code,runningAfter:runningCount});
  if (playerSum > 21){ await finishRound(false); return; }
  btnHit.disabled = false;
}

/* initialize shoe and UI */
(function init(){
  buildDecks(2);
  shuffle(deck);
  runningCount = 0;
  roundIndex = 0;
  rounds = [];
  cardsLeftEl.textContent = deck.length;
  balanceDisplay.textContent = '$' + balance;
  wonDisplay.textContent = '$' + totalWon;
  sessionNotice.textContent = 'Zapato listo (2 mazos) — presiona "Empezar ronda"';
  updateRunningCount();
})();
</script>
</body>
</html>